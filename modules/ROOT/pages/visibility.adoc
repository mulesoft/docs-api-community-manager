= Configure API Visibility
ifndef::env-site,env-github[]
include::_attributes.adoc[]
endif::[]
:imagesdir: ../assets/images/

Anypoint API Community Manager uses visibility rules to make APIs visible to selected groups of users.

For example, your community could have a Payment API and a Trade API visible to the financial developers team of users Ann, John, and Tim, and have an Order Submission API visible to the retail developers team of users Charles and Xiomara.

API visibility rules use the Salesforce object *CommunityApi* to represent each API published in your community, and Salesforce https://help.salesforce.com/articleView?id=sf.user_groups.htm&type=5[Public Groups, role=external, window=blank] and https://help.salesforce.com/articleView?id=sf.security_about_sharing_rules.htm&type=5[Sharing Rules, role=external, window=blank] to provide a flexible permissions model.

To set API visibility, link each public group of users to a sharing set, and grant each sharing set permission to see one or more APIs.

== Visibility Setup

Follow these steps to set up API visibility in your community.

=== Configure Your Community for Visibility

Follow these steps to configure your community for API visibility:

. Create a new *ACM Community User Plus* profile based on the *Customer Community User Plus* profile:
.. Open *Salesforce Setup* > *Profiles*.
.. Select the *Customer Community User Plus* profile.
.. Click *Clone*.
.. Enter a name for the new profile that represents the use case, such as `External Developer`.
.. Assign permissions that match the member user profile permissions described in the API Community Manager documentation section xref:create-community.adoc#configure-member-user-profile-permissions[Configure Member User Profile Permissions].
. Configure your community to use the new *ACM Community User Plus* profile:
.. Open *Setup* > *All Communities*.
.. In the API Community Manager control panel, open *Community Administration* and open the *Members* tab.
.. In the *Select Profiles* section, use the search dropdown to select *Customer*.
.. Add the new *ACM Community User Plus* profile to the selected profiles.
.. _Do not_ remove the *System Administrator* profile.
+
If you remove the *System Administrator* profile, the system locks you out and removes all access to your community.
.. Remove the existing *ACM Community User* profile.
. Remove all profiles from your community sharing set:
.. Open *Setup* > *Communities Settings*.
.. In the *Sharing Sets* section, edit your community sharing set and remove all profiles from the *Selected Profiles*.
.. If the *Selected Objects* in the sharing set include *CommunityApi*, remove *CommunityApi* from the *Selected Objects*.
. If your community already has users, open *Setup* > *Users* and update each user to change the *User License* to *Customer Community Plus* and select the new *ACM Community User Plus* profile.
. In the API Community Manager control panel, set the visibility of each of your APIs to *Members Only*.

=== Define Member Groups (Public Groups)

Use member groups, also known as public groups, to group members and then make individual APIs visible to the group. Visibility rules, also known as sharing settings, determine the APIs visible to a member group.

To create a member group:

. Open *Setup* > *Public Groups*.
. Create a *Public Group*.
. Enter a name, such as `External Developers`.
. Click *Save*.

To add members to a member group:

. Open *Setup* > *Public Groups*.
. Edit the group.
. In the *Search* dropdown, select *Customer Portal Users*.
. Add the members by moving them from *Available Members* to *Selected Members*.
+
*Available Members* shows only users with the new *ACM Community User Plus* profile. If the user you want to add is not in *Available Members*, open the user record and verify the profile.
. Click *Save*.

=== Define Visibility Rules (Sharing Settings) for APIs

Use visibility rules, also known as sharing settings, to define a set of conditions that determine if an API is visible to a specific member group.

To create a new sharing set:

. Open *Setup* > *Sharing Settings*.
. In the dropdown *Manage sharing settings for*, scroll down and select *CommunityApi*.
. In the *Sharing Rules* section, click *New*.
. Enter a name for the rule.
. In the *Select your rule type* section, select *Based on Criteria*.
. Define your desired criteria using the available fields on the API, such as *Name* and *Visibility*.
+
Use the *Add Filter Logic* option to define more complex rules with and/or conditions.
. Select the member group that sees the APIs matching these conditions.

In this example, an internal developer group sees publicly visible APIs and some internal APIs:

image::sharing-settings.png[Sharing Settings]

== Add Members to a Member Group

To add members to a member group:

. Open *Setup* > *Public Groups*.
. Edit the group.
. In the *Search* dropdown, select *Customer Portal Users*.
. Add the members by moving them from *Available Members* to *Selected Members*.
+
*Available Members* shows only users with the new *ACM Community User Plus* profile. If the user you want to add is not in *Available Members*, open the user record and verify the profile.
. Click *Save*.

== Make an API Visible to a Member Group

. Open *Setup* > *Sharing Settings*.
. In the dropdown *Manage sharing settings for*, scroll down and select *CommunityApi*.
. In the *Sharing Rules* section, create a new rule or edit an existing rule.
. Ensure the rule matches the API.
. Ensure the rule specifies the member group.

== Automation

Assign users to member groups automatically with any of these options.

=== Process Builder for Simple Scenarios

Use Salesforce https://help.salesforce.com/articleView?id=sf.process_overview.htm&type=5[Process Builder, role=external, window=blank] for simple scenarios such as adding each new user to a default public group.

=== APEX Triggers for Complex Scenarios

Use https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_triggers.htm[APEX triggers, role=external, window=blank] to write business rules for group assignment directly in APEX code.

=== Flows for Complex Scenarios

Use Salesforce https://help.salesforce.com/articleView?id=sf.flow.htm&type=5[Flows, role=external, window=blank] to perform group assignment declaratively.
